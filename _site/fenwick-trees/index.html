<!DOCTYPE html>
<html>
  <head>
    <title>Binary indexed trees/ Fenwick trees – The Programming Club</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="– Range Queries with Point/Range Updates

" />
    <meta property="og:description" content="– Range Queries with Point/Range Updates

" />
    
    <meta name="author" content="The Programming Club" />

    
    <meta property="og:title" content="Binary indexed trees/ Fenwick trees" />
    <meta property="twitter:title" content="Binary indexed trees/ Fenwick trees" />
    
    <meta name="theme-color" content="#2C3E50">
    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <link rel="shortcut icon big" sizes="192x192" href="big_icon.png ">
    <link rel="stylesheet" type="text/css" href="/blog/style.css" />
    <link rel="stylesheet" type="text/css" href="/blog/font-awesome/css/font-awesome.min.css" />
    <link rel="alternate" type="application/rss+xml" title="The Programming Club - Indian Institute of Technology, Indore" href="/blog/feed.xml" />
    <meta name="mobile-web-app-capable" content="yes">
   
 <!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Binary indexed trees/ Fenwick trees | The Programming Club</title>
<meta property="og:title" content="Binary indexed trees/ Fenwick trees" />
<meta name="author" content="Kumar Abhinav" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="– Range Queries with Point/Range Updates" />
<meta property="og:description" content="– Range Queries with Point/Range Updates" />
<link rel="canonical" href="http://0.0.0.0:4000/blog/fenwick-trees/" />
<meta property="og:url" content="http://0.0.0.0:4000/blog/fenwick-trees/" />
<meta property="og:site_name" content="The Programming Club" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-09-09T00:00:00+05:30" />
<script type="application/ld+json">
{"name":null,"description":"– Range Queries with Point/Range Updates","author":{"@type":"Person","name":"Kumar Abhinav"},"@type":"BlogPosting","url":"http://0.0.0.0:4000/blog/fenwick-trees/","publisher":null,"image":null,"headline":"Binary indexed trees/ Fenwick trees","dateModified":"2017-09-09T00:00:00+05:30","datePublished":"2017-09-09T00:00:00+05:30","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/blog/fenwick-trees/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="https://avatars3.githubusercontent.com/u/31797871"/></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">The Programming Club</a></h1>
            <p class="site-description">Indian Institute of Technology, Indore</p>
          </div>

          <nav>
            <a href="/blog/">Blog</a>
            <a href="/projects.html">Projects</a>
            <a href="/about.html">About</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <article class="post">
  <h1>Binary indexed trees/ Fenwick trees</h1>
  <h4>Kumar Abhinav</h4>
  <div class="date">
    September  9, 2017
  </div>
  
  <div class="entry">
    <p>– Range Queries with Point/Range Updates</p>

<h1 id="a-general-overview-">A general overview:-</h1>
<p>Binary Indexed trees are generally used in problems asking you to update or give the sum of a particular range. Here I am going to deal with two special cases of Fenwick Trees</p>
<ol>
  <li>Range Update with Point Query</li>
  <li>Range Update with Range Query</li>
</ol>

<p>The basic form of Binary Indexed Tree is used for Point Update with Range Query, i.e., problems that simplify to<br />
Given an array A[1..N] , perform the following operations</p>
<ol>
  <li>Add Y to A[X]</li>
  <li>Output Sum(A[L..R])</li>
</ol>

<p><strong>Constraints</strong></p>
<ul>
  <li>N ~ 100000</li>
  <li>Q ~ 100000</li>
  <li>1&lt;=L&lt;=R&lt;=N</li>
  <li>1&lt;=X&lt;=N</li>
  <li>1&lt;=Y&lt;=10^9</li>
</ul>

<p>Where Q is the number of Queries to perform</p>

<p>Knowledge of solving such problems using Fenwick Trees is a prerequisite to this tutorial. You can refer <a href="https://www.topcoder.com/community/data-science/data-science-tutorials/binary-indexed-trees/">this</a> tutorial on Topcoder to learn basics of Fenwick Trees.</p>

<p>1) Range Update Point Query
We’ll be solving the following problem in this tutorial:-
Given an array A[1..N], all zero initially, perform the following operations:-</p>
<ol>
  <li>Add Y to every element in the range A[L..R]</li>
  <li>Output A[X]
<strong>Constraints</strong>
    <ul>
      <li>N ~ 100000</li>
      <li>Q ~ 100000</li>
      <li>1&lt;=L&lt;=R&lt;=N</li>
      <li>1&lt;=X&lt;=N</li>
      <li>1&lt;=Y&lt;=10^9<br />
Where Q is the number of Queries to perform</li>
    </ul>
  </li>
</ol>

<h3 id="naïve-solution">Naïve solution</h3>
<p>The naïve solution to this problem is very clear</p>
<ol>
  <li>We maintain an array of numbers, initialized to zero</li>
  <li>For every Update query, we iterate over the array from L to R, and add Y to every element</li>
  <li>For every Output query, we print A[X]
Every output query takes O(1) time and every update query takes O(N) time, so in worst case, the solution will take O(N*Q), which will sadly TLE (unless time limit is a day or two :P )</li>
</ol>

<h3 id="a-slightly-different-solution">A slightly different solution</h3>
<p>Instead of updating the whole range why not we just update two indexes. Wait, how! You must be asking, find out below :D</p>
<ol>
  <li>Maintain an array, initialized to zero</li>
  <li>For every Update query, add Y to A[L], and subtract Y from A[R+1]</li>
  <li>For every Output query, print sum(A[1..X])<br />
How this works?<br />
Assume sum(A[X]) gives the correct answer before our update query. Now, when we add Y to A[L], sum(A[X]) for every index&gt;=L will now be increased by Y. But, for index &gt; R, the value must not be increased, therefore we decrease A[R+1] by Y, and now our algorithm gives correct answer for all the indexes again! Since the array was initialized to zero, it will definitely give the correct output for every output query before an update query. Since we just proved that every update maintains the correctness, we have proved that our algorithm is correct by induction. Awesome!</li>
</ol>

<p>Okay, so now update query is O(1), but now Output query is O(N), so the worst case complexity is 
Still O(Q*N), and our solution will still TLE.
So, why did we even consider this approach? 
Notice something, in this approach update query is essentially updating two indexes (Point Update), and output query is basically sum of first X numbers (Range Query). Which algorithm is fast when it comes to point update range query? Déjà vu?</p>

<h3 id="binary-indexed-tree-solution">Binary Indexed Tree Solution</h3>
<p>The solution is basically building our BIT atop the array we defined in the previous approach.
 For every range update query A[L..R], we do two BIT updates, one at index L and the other at index R+1.
 For every point query A[X], we return BIT query at index X. 
Both type of queries runs in O(logN) time, so the overall time complexity is O(Q*log N), which is fast enough to pass time limits. Yay!! :D<br />
C++ Implementation</p>
<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span><span class="k">class</span> <span class="nc">BIT</span>
<span class="p">{</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">bit</span><span class="p">;</span>  
    <span class="k">public</span><span class="o">:</span>  
    <span class="n">BIT</span><span class="p">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">=</span><span class="mf">1e5</span><span class="p">)</span>  
    <span class="p">{</span>  
        <span class="n">bit</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>  
    <span class="p">}</span>  
    <span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">start</span><span class="p">,</span><span class="kt">int</span> <span class="n">end</span><span class="p">,</span><span class="n">T</span> <span class="n">val</span><span class="p">)</span>  
    <span class="p">{</span>  
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">start</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">bit</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="n">i</span><span class="o">+=</span><span class="n">i</span><span class="o">&amp;</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">))</span>  
            <span class="n">bit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+=</span><span class="n">val</span><span class="p">;</span>  
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">end</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">bit</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="n">i</span><span class="o">+=</span><span class="n">i</span><span class="o">&amp;</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">))</span>  
            <span class="n">bit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-=</span><span class="n">val</span><span class="p">;</span>  
    <span class="p">}</span>  
    <span class="n">T</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">loc</span><span class="p">)</span>  
    <span class="p">{</span>  
        <span class="n">T</span> <span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>  
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">loc</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">-=</span><span class="n">i</span><span class="o">&amp;</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">))</span>  
            <span class="n">ans</span><span class="o">+=</span><span class="n">bit</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>  
        <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>  
    <span class="p">}</span>  
<span class="p">};</span>  
</code></pre>
</div>

  </div>


  
</article>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          
<a href="mailto:progclub@iiti.ac.in"><i class="fa fa-envelope"></i></a>
<a href="https://www.facebook.com/pclubiiti"><i class="fa fa-facebook"></i></a>

<a href="https://github.com/pclubiiti"><i class="fa fa-github"></i></a>




<a href="https://www.twitter.com/pclubiiti"><i class="fa fa-twitter"></i></a>



        </footer>
      </div>
    </div>

    
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-106481637-1', 'auto');
		ga('send', 'pageview', {
		  'page': '/blog/fenwick-trees/',
		  'title': 'Binary indexed trees/ Fenwick trees'
		});
	</script>
	<!-- End Google Analytics -->


  </body>
</html>
